# Feature Contract Matrix

| Feature | Expected behavior | Current break (pre-fix) | Owner file(s) |
|---|---|---|---|
| Series backup import/export | JSON backup contracts are series-scoped (series + novels + series codex), not single-novel import | UI/commands used project backup import with missing series contract and incompatible payload shape | `frontend/hooks/use-import-export.ts`, `frontend/features/data-management/components/data-management-menu.tsx`, `frontend/features/data-management/components/RestoreProjectDialog.tsx`, `backend/src/commands/backup.rs`, `backend/src/lib.rs`, `frontend/core/tauri/commands.ts` |
| Novel export wiring | Individual novel exports are handled via document export dialog (PDF/DOCX/ePub) | Export dialog existed but was not wired into project cards | `app/series/page.tsx`, `frontend/features/dashboard/components/ProjectCard.tsx`, `frontend/features/export/components/export-dialog.tsx` |
| Project discoverability | `list_projects` should return all valid projects (not just short-lived recent entries) | Project list was tied to 30-day recent cache and could hide imported/older projects | `backend/src/commands/project.rs` |
| Series metadata persistence | Series supports title/description/author/genre/status and persists across list/update | Backend model/update only reliably persisted title | `backend/src/models/project.rs`, `backend/src/commands/series.rs`, `frontend/core/tauri/commands.ts`, `frontend/infrastructure/repositories/TauriSeriesRepository.ts` |
| Scene metadata persistence | Scene metadata actions (POV, subtitle, labels, exclude-from-AI, summary, archive) persist in scene frontmatter and round-trip to UI | `updateMetadata` only updated title; backend frontmatter parsing/writing did not support required metadata fields | `backend/src/models/scene.rs`, `backend/src/commands/scene.rs`, `backend/src/lib.rs`, `frontend/core/tauri/commands.ts`, `frontend/infrastructure/repositories/TauriNodeRepository.ts`, `frontend/features/editor/components/NodeActionsMenu.tsx` |
| Timeline metadata rendering | Story timeline cards show persisted POV/subtitle/exclude flags and live word counts | Timeline read metadata fields that were not being hydrated from backend scene files | `frontend/infrastructure/repositories/TauriNodeRepository.ts`, `frontend/features/editor/components/story-timeline.tsx` |
| Plan timeline search | Timeline view should honor search query from plan toolbar | Search query prop was ignored | `frontend/features/plan/components/timeline-view.tsx` |
| Plan category filter | Category filter should constrain scene set via scene-codex links | Category filter state was cosmetic only | `frontend/features/plan/components/plan-view.tsx` |
| Matrix link persistence | Matrix checkboxes should persist and reflect scene-codex links | Checkboxes used static `defaultChecked={false}` with no save path | `frontend/features/plan/components/matrix-view.tsx` |
| Search to codex deep-link | Selecting codex result in search opens codex pane and selected entity | Codex search selection only closed palette | `frontend/features/search/components/SearchPalette.tsx`, `frontend/store/use-project-store.ts`, `frontend/features/navigation/components/ProjectNavigation.tsx`, `frontend/features/editor/components/EditorContainer.tsx`, `frontend/features/codex/components/codex-list.tsx` |
| Mention project routing | Mention queries resolve backend project path from active project identity | Mention repo passed project ID as path; active project ID was never set reliably in runtime | `app/project/page.tsx`, `frontend/infrastructure/repositories/TauriMentionRepository.ts`, `frontend/hooks/use-mentions.ts` |
| Mention snippet scanning | Mention scan should inspect snippet files stored in `snippets/*.json` | Backend scanned legacy `.meta/snippets.json` path | `backend/src/commands/mention.rs` |
| Series-first search backend | Backend full-text search should read series codex path (fallback to legacy) | Search command hardcoded `.meta/codex` only | `backend/src/commands/search.rs` |
| Context assembly fidelity | Broad context scopes should include full scene content, not scene stubs | Context assembly built scenes from list stubs without guaranteed content hydration | `frontend/hooks/use-context-assembly.ts` |
| Chat settings plumbing | Chat `topP`, `frequencyPenalty`, `presencePenalty` settings affect generation requests | UI exposed settings that were not passed through hook/client layer | `frontend/features/chat/components/chat-thread.tsx`, `frontend/hooks/use-ai.ts`, `frontend/lib/ai/client.ts` |
| Chat model consistency | Request should always use effective selected model | Effective model and streaming model state could diverge | `frontend/hooks/use-ai.ts`, `frontend/features/chat/components/chat-thread.tsx` |
| Data menu UX contract | Backup menu labels and actions should match available capabilities | Dashboard menu showed database-level labels while feature was app-level backup/import flow | `frontend/features/data-management/components/data-management-menu.tsx` |
| Scene export label clarity | Scene export menu item should describe actual output format | Menu implied generic export while action produced `.txt` | `frontend/features/editor/components/NodeActionsMenu.tsx` |
| Dead code hygiene | Remove orphaned tooltip component and stale lint suppressions | Unreferenced editor tooltip file and stale unused-param suppressions blocked lint | `frontend/features/editor/components/codex-mention-tooltip.tsx`, `frontend/features/plan/components/matrix-view.tsx`, `frontend/infrastructure/repositories/TauriCollaborationRepository.ts` |
