sequenceDiagram
    actor User
    participant Settings as Settings Dialog
    participant AuthHook as useGoogleAuth
    participant DriveHook as useGoogleDrive
    participant OAuth as Google OAuth 2.0
    participant DriveAPI as Google Drive API
    participant Backend as Tauri Backend
    participant Filesystem as Filesystem
    
    User->>Settings: Click "Backup to Drive"
    Settings->>AuthHook: Check auth status
    AuthHook->>AuthHook: Read tokens from localStorage
    alt No valid token
        AuthHook->>OAuth: Initiate PKCE flow
        OAuth-->>User: Redirect to Google consent
        User->>OAuth: Approve permissions
        OAuth-->>AuthHook: Authorization code
        AuthHook->>OAuth: Exchange code for tokens
        OAuth-->>AuthHook: Access + refresh tokens
        AuthHook->>AuthHook: Store in localStorage
    end
    Settings->>DriveHook: uploadBackup(projectPath)
    DriveHook->>Backend: export_project_backup(projectPath)
    Backend->>Filesystem: Read all project files
    Backend->>Backend: Assemble JSON backup
    Backend-->>DriveHook: JSON string
    DriveHook->>DriveAPI: POST /upload/drive/v3/files
    Note over DriveAPI: Upload JSON as file
    DriveAPI-->>DriveHook: File metadata
    DriveHook-->>Settings: Success
    Settings->>User: Show "Backup complete"
    Note over User,Settings: Backed up to Drive âœ…
